<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Client ↔ Stripe Matcher</title>
  <style>
    :root {
      --bg: #0b1220;
      --muted: #19223a;
      --card: #0f172a;
      --accent: #4f46e5;
      --accent-2: #22c55e;
      --text: #e5e7eb;
      --subtle: #94a3b8;
      --warn: #f59e0b;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, var(--bg), #0a0f1a 65%);
      color: var(--text);
    }
    header {
      padding: 28px 20px 10px; text-align: center; position: sticky; top: 0; backdrop-filter: blur(8px); background: linear-gradient(180deg, rgba(11,18,32,.9), rgba(11,18,32,.6)); z-index: 40; border-bottom: 1px solid #1f2937;
    }
    h1 { font-size: 22px; margin: 0 0 6px; letter-spacing: .2px; }
    .subtitle { color: var(--subtle); font-size: 13px; }
    main { max-width: 1200px; margin: 20px auto 80px; padding: 0 16px; }

    .grid { display: grid; gap: 14px; }
    @media (min-width: 920px) { .grid-3 { grid-template-columns: repeat(3, 1fr);} }
    @media (max-width: 919px) { .grid-3 { grid-template-columns: 1fr; } }

    .card { background: var(--card); border: 1px solid #1f2937; border-radius: 14px; padding: 16px; box-shadow: 0 8px 30px rgba(0,0,0,.25); }
    .card h2 { font-size: 16px; margin: 0 0 8px; }
    .card h3 { font-size: 14px; margin: 0 0 8px; color: var(--subtle); font-weight: 600; }

    .hint { color: var(--subtle); font-size: 12px; }
    .row { display:flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .row > * { flex: 1; }

    .filebox { border: 1px dashed #334155; padding: 10px; border-radius: 10px; background: #0b1220; }
    input[type="file"] { width: 100%; padding: 8px; color: var(--subtle); }

    select, input[type="text"], input[type="number"], input[type="checkbox"] {
      background: #0b1220; border: 1px solid #334155; color: var(--text); padding: 8px 10px; border-radius: 10px; width: 100%; outline: none;
    }
    label { font-size: 12px; color: var(--subtle); display:block; margin: 6px 0 4px; }

    .btn { background: var(--accent); color: white; border: none; padding: 10px 14px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: transform .04s ease, opacity .2s; }
    .btn:hover { transform: translateY(-1px); }
    .btn:disabled { opacity: .5; cursor: not-allowed; }
    .btn-outline { background: transparent; border: 1px solid #334155; }
    .btn-ghost { background: transparent; color: var(--text); }
    .btn-success { background: var(--accent-2); }
    .btn-warn { background: var(--warn); color: #111827; }

    .pill { display:inline-flex; gap:6px; align-items:center; padding: 2px 8px; border-radius: 999px; font-size: 11px; border: 1px solid #334155; background:#0b1220; color: var(--subtle); }
    .pill.new { border-color: #2563eb; color:#bfdbfe; }
    .pill.multi { border-color: #22c55e; color:#bbf7d0; }

    .tabbar { display:flex; gap: 8px; flex-wrap: wrap; margin: 12px 0; }
    .tabbar button { background: #0b1220; border: 1px solid #334155; color: var(--subtle); padding: 8px 12px; border-radius: 10px; cursor:pointer; }
    .tabbar button.active { background: var(--accent); color: white; border-color: transparent; }

    details summary { cursor: pointer; user-select: none; }
    details { border: 1px solid #1f2937; border-radius: 12px; padding: 10px 12px; background: #0b1220; }
    details + details { margin-top: 8px; }
    details .summary-row { display:flex; justify-content: space-between; align-items:center; gap: 8px; }

    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { text-align: left; padding: 8px 10px; border-bottom: 1px solid #1f2937; font-size: 13px; }
    th { color: var(--subtle); font-weight: 600; }

    .right { text-align: right; }

    .footer { color: var(--subtle); font-size: 12px; text-align:center; margin-top: 18px; }

    .spacer { height: 10px; }

    .tag { display:inline-block; font-size:11px; padding: 2px 6px; border-radius: 6px; background: #111827; border: 1px solid #334155; color: #e5e7eb; }
    .tag.fb { background:#0b1322; border-color:#1e40af; }
    .tag.tt { background:#08131a; border-color:#0ea5e9; }
    .tag.yt { background:#1a0b0b; border-color:#b91c1c; }
    .tag.smm { background:#10111a; border-color:#7c3aed; }
    .tag.csm { background:#0e1a12; border-color:#16a34a; }

    .badge { display:inline-flex; align-items:center; gap:6px; font-size: 11px; padding: 2px 6px; border-radius: 999px; border:1px solid #334155; color:#cbd5e1; }

    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background:#0a0f1a; border:1px solid #334155; border-bottom-width:2px; padding: 2px 6px; border-radius:6px; font-size:12px; }
  </style>
</head>
<body>
  <header>
    <h1>Client ↔ Stripe Matcher</h1>
    <div class="subtitle">Upload CSVs → Map columns → Match by <span class="kbd">Customer ID</span>, <span class="kbd">Email</span>, or <span class="kbd">Name</span> → Summaries per person & platform. <strong>If a team column contains multiple names, <em>each</em> matching AM gets credit for that client.</strong></div>
  </header>

  <main>
    <!-- Upload / Mapping / Run sections stay as in your previous version -->
    <div id="mapping-main"></div>
    <div id="mapping-onboard" style="margin-top:12px"></div>
    <div id="mapping-stripe" style="margin-top:12px"></div>
  </main>

  <script>
    /*****************
     * Config: Teams *
     *****************/
    const TEAMS = {
      Facebook: [
        "Evarose",
        "Charlene",
        "Joshua Advincula",
        "Rainier Vann Muñoz",
        "Marie Guirjen",
        "Veronica Trigo",
        "May Muñoz",
      ],
      TikTok: [
        "Laura Dimadi",
        "Carren Evangelista",
      ],
      YouTube: [
        "Cade Holmquist",
        "YouTube",
      ],
      SMM: [
        "Jasmine Garcia",
        "Krilen Andoque",
      ],
      CSM: [
        "Kizzia",
        "Anthony Jenkins",
        "Rain G",
        "Sandra Catalina Mateus Abdala",
        "Shao",
        "Preston Mast",
        "Niima Biuibrahim"
      ]
    };

    // Normalize duplicate names
    for (const k of Object.keys(TEAMS)) {
      TEAMS[k] = Array.from(new Set(TEAMS[k]));
    }

    /*****************
     * Column mapping *
     *****************/
    const MAIN_FIELDS = [
      { key: 'clientName', label: 'Client Name' },
      { key: 'email', label: 'Email' },
      { key: 'stripeId', label: 'Customer/Stripe ID' },
      { key: 'amFacebook', label: 'Facebook AMs (multiple names allowed)' },
      { key: 'amTikTok', label: 'TikTok AMs (multiple names allowed)' },
      { key: 'amYouTube', label: 'YouTube AMs (multiple names allowed)' },
      { key: 'amSMM', label: 'SMM' },
      { key: 'amCSM', label: 'CSM' },
    ];

    const STRIPE_FIELDS = [
      { key: 'stripeId', label: 'Customer/Stripe ID' },
      { key: 'clientName', label: 'Customer Name' },
      { key: 'email', label: 'Email' },
      { key: 'amount', label: 'Amount Paid (numeric)' },
    ];

    /* --- rest of the JS logic unchanged (CSV parsing, matching, rendering, exporting, etc.) --- */
  </script>
</body>
</html>
